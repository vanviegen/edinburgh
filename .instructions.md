# Instructions for AI Contributors

## Project Overview

Edinburgh is a high-performance TypeScript ORM built on OLMDB/LMDB, providing type-safe model definitions with automatic field validation, ACID transactions, and efficient database storage. It features optimistic locking, automatic back-references, custom indexing, and on-demand reference loading.

## How It Works

1. Models are defined as classes extending `E.Model<T>` with typed fields using `E.field()`
2. TypeScript compiler provides compile-time type safety while runtime validation ensures data integrity
3. Transactions use optimistic locking with automatic retry on conflicts
4. Indexes enable efficient querying with primary, unique, and secondary index support
5. Links between models are automatically managed, with optional back-references

## Most Important Files

- **`src/edinburgh.ts`** - Main entry point, exports public API and transaction management
- **`src/models.ts`** - Core `Model` class, field definitions, and model registration system
- **`src/types.ts`** - Type wrapper system for serialization, validation, and TypeScript inference
- **`src/indexes.ts`** - Storage layer, based on K/V pairs for primary key with other fields in values, and secondary indexes
- **`tests/edinburgh.test.ts`** - Comprehensive test suite covering all major functionality
- **`tests/bytes.test.ts`** - Tests for the binary serialization system

## Development Hints

- Be very conservative in the amount of code you add or change
- Always look for opportunities to **refactor and reduce complexity/duplication**
- If you see an opportunity for a non-trivial refactor that will reduce code size and/or complexity, propose it to me first
- The quickest way to run test is through `bun test` -- if you also need to run tests in Node.js (usually not needed), use `npm run test:node`
- Create tests for all new features and create test cases for bugs you're fixing
- Pay special attention to TypeScript type inference and runtime validation alignment
- Use `// @ts-expect-error` comments in the tests to validate that TypeScript rejects invalid data types (but do so only in non-trivial cases)
- In general, don't test trivial stuff, like simple getters/setters
- Focus on **correctness, type safety, performance and code minimization** (in roughly that order)
- After you get your code to work, review for opportunities to simplify/reduce complexity

## Keeping This File Updated

- Keep this file **brief** - only top-level workflow info
- Update when major workflow changes occur
- Always maintain the "minimize code" emphasis
